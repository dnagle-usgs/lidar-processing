<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!--
  For best results, please view this file in a modern web browser.
-->
<head>
  <title>ALPS installation documentation</title>
  <style type="text/css">
    body {
      color: black;
      background-color: white;
      margin: 1em;
      text-align: center;
    }
    #main {
      max-width: 40em;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    #title {
      border-bottom: none;
      text-align: center;
      font-size: 2em;
      padding-top: .5em;
      padding-bottom: 1em;
    }
    h1 {
      padding-top: 0.25em;
      font-size: 1.5em;
      border-bottom: solid 1px black;
    }
    h2 {
      font-size: 1.2em;
    }
    h3 {
      font-size: 1em;
    }
    pre.code {
      overflow: auto;
      padding: 0.5em 0.75em;
      margin: 1em 5em;
      background-color: #f1f1f1;
      border: 1px solid gray;
    }
    strong.file, strong.directory, strong.variable, strong.command {
      font-size: 90%;
      font-weight: normal;
      font-family: courier, "courier new", fixed, monospace;
    }
    .file, .directory {
      color: #990000;
    }
    .variable {
      color: #000099;
    }
    .command {
      color: #009900;
    }
    .replaceable {
      background-color: #dddddd;
    }
    pre.code .replaceable {
      background-color: #d0d0d0;
    }
    dl dt {
      font-weight: bold;
      margin-top: 0.75em;
    }
    dl dd {
      padding-left: 0;
      margin-left: 2em;
    }
    @media print {
      .noprint {
        display: none;
      }
      a {
        text-decoration: none;
        color: #000000;
      }
      a[href^="http://"]:after {
        content: " (" attr(href) ")";
        font-size: 80%;
      }
      pre.code {
        overflow: visible;
        white-space: pre-wrap;
      }
      h1, h2 {
        page-break-after: avoid;
      }
      pre.code {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
<div id="main">

<h1 id="title">How to install ALPS</h1>

<h1 id="toc">Table of contents</h1>
<ul class="toc">
<li><a href="#toc">Table of contents</a></li>
<li><a href="#conventions">Conventions</a></li>
<li><a href="#install_package">Installing ALPS</a>
  <ul>
  <li><a href="#install_package_basic">Basic installation</a></li>
  <li><a href="#install_prefix">Installing to an alternate location</a></li>
  </ul>
</li>
<li><a href="#troubleshooting">Troubleshooting</a>
  <ul>
  <li><a href="#need_pkgs">Missing packages</a></li>
  <li><a href="#need_sudo">Installing with sudo</a></li>
  <li><a href="#disable_rlwrap">Problems with rlwrap</a></li>
  <li><a href="#cctools_readline">Readline problems with cctools</a></li>
  <li><a href="#fixed_width">GUIs have fixed-width font</a></li>
  <li><a href="#distclean">Modified configuration</a></li>
  </ul>
</li>
<li><a href="#upgrade_package">Upgrading ALPS</a>
  <ul>
    <li><a href="#upgrade_package_overview">Upgrade overview</a></li>
    <li><a href="#upgrade_selective">Selective upgrade</a></li>
    <li><a href="#nodata_download">The "-nodata" download</a></li>
    <li><a href="#bye_activetcl">What happened to ActiveTcl?"</a></li>
    <li><a href="#migrating_201004">Upgrading installations from prior to April 2010</a></li>
    <li><a href="#migrating_201007">Upgrading installations from prior to July 2010</a></li>
    <li><a href="#migrating_201109">Upgrading installations from prior to September 2011</a></li>
    <li><a href="#migrating_201504">Upgrading installations from prior to April 2015</a></li>
  </ul>
</li>
<li><a href="#prep_package">Preparing an installation package</a>
  <ul>
    <li><a href="#prep_scratch">From scratch</a></li>
    <li><a href="#prep_exist">From an existing installer</a></li>
  </ul>
</li>
</ul>

<h1 id="conventions">Conventions</h1>

<p>
  This document styles certain key words and phrases in special ways to help
  denote their meanings and set them apart from normal text. For best results,
  please render this document in a modern web browser. Inline stylings used are
  as follows.
</p>

<ul>
<li>
  <strong class="command">commands</strong> are typically executable programs
  such as <strong class="command">make</strong> or <strong
  class="command">tar</strong>.
</li>
<li>
  <strong class="file">file names</strong> and <strong
  class="directory">directory names</strong> can be either literal or
  illustrative paths to files and directories.
</li>
<li>
  <strong class="variable">variable names</strong> and <strong
  class="variable">options</strong> are keywords that allow the user to
  customize how something works.
</li>
<li>
  <span class="replaceable">replaceable text</span> signifies that the text
  isn't necessarily going to match what you need to type. For example, file
  names often have components that can vary, and some settings may receive
  values that you specify. This can occur in conjunction with other styles; for
  example, this file will always start with "alpsinstall" but the date in the
  name may vary: <strong class="file">alpsinstall.<span
  class="replaceable">20100328</span>.tar</strong>.
</li>
</ul>

<p>
  Additionally, series of commands that you are expected to type on the command
  line are set off in a format like this:
</p>

<pre class="code">
<span class="command">echo</span> This is an example of a code block.
<span class="command">tar</span> xvf <span class="file">alpsinstall.<span class="replaceable">20100328</span>.tar</span>
</pre>

<p>
  The above listing contains two separate commands: an <strong
  class="command">echo</strong> command and a <strong
  class="command">tar</strong> command. Code blocks also make use of the same
  inline stylings noted above.
</p>

<h1 id="install_package">Installing ALPS</h1>

<h2 id="install_package_basic">Basic installation</h2>

<p>
  The easiest way to install ALPS is to use a premade installer package that
  already has everything you'll need assembled together in one place. The
  installer package is distributed as a tarball, with a name like <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>.tar.bz2</strong>. (The date in the file
  name indicates when the installer package was assembled. Newer is better.)
  Once you have the ALPS installer package, you will need to unwrap it:
</p>

<pre class="code">
<span class="command">tar</span> xjf <span class="file">alpsinstall.<span class="replaceable">20100328</span>.tar.bz2</span>
</pre>

<p>
  This will create the directory <strong class="directory">alpsinstall.<span
  class="replaceable">20100328</span></strong>. You can now enter this
  directory and install ALPS:
</p>

<pre class="code">
<span class="command">cd</span> <span class="directory">alpsinstall.<span class="replaceable">20100328</span>/</span>
<span class="command">make</span> install
</pre>

<p>
  That's it. Unless your system runs into problems with something or unless
  you'd like to customize something, you're done! ALPS installs to <strong
  class="directory">/opt/alps/</strong> by default, so you can now start ALPS
  like this:
</p>

<pre class="code">
<span class="command">cd</span> <span class="directory">/opt/alps/lidar-processing/src/</span>
<span class="command">./alps</span>
</pre>

<p>
  (If you encounter permissions problems when trying to install, you probably
  don't have permissions to access <strong
  class="directory">/opt/alps</strong>. If you have permission to use <strong
  class="command">sudo</strong>, you can follow the directions at <a
  href="#need_sudo">Installing with sudo</a>. Otherwise, follow the directions
  at <a href="#install_prefix">Installing to an alternate location</a>.)
</p>

<p>
  The rest of this section documents some customizations that are commonly
  applied.
</p>

<h2 id="install_prefix">Installing to an alternate location</h2>

<p>
  By default, ALPS will be installed at <strong
  class="directory">/opt/alps</strong>. If you'd rather install it somewhere
  else, use the <strong class="variable">prefix</strong> setting to specify the
  desired directory path. For example, to install ALPS under your home
  directory at <strong class="directory">~/alps</strong>:
</p>

<pre class="code">
<span class="command">make</span> install <span class="variable">prefix</span>=<span class="directory">~/alps</span>
</pre>

<p>
  (Note: If you are doing something more involved than just installing, be
  aware that you should include <strong class="variable">prefix</strong> on
  <strong>all</strong> calls to <strong class="command">make</strong>.)
</p>

<h1 id="troubleshooting">Troubleshooting</h1>

<h2 id="need_pkgs">Missing packages</h2>

<p>
  Depending on the Linux distribution you are running and how it was installed,
  you may need to install some additional packages through your distribution's
  package manager in order for ALPS to install. If you run into problems during
  installation, this should be the first thing you check.
</p>

<p>
  Each distribution has its own mechanisms for handling package management.
  Further, the exact names of packages may change over time. This makes it
  difficult to enumerate the exact steps required under every available
  platform.
</p>

<p>
  Debian-based systems such as Ubuntu use <strong
  class="command">apt-get</strong> to manage packages from the command line. If
  you know exactly which packages (by name) you need to install, you can easily
  use <strong class="command">apt-get</strong>.  In testing, these were the
  packages required under Ubuntu:
</p>

<pre class="code">
<span class="command">sudo apt-get</span> install asciidoc \
    build-essential \
    docbook2x \
    gettext \
    libbz2-dev \
    libcurl4-gnutls-dev \
    libexpat1-dev \
    libjpeg62-dev \
    libncurses-dev \
    libpng12-dev \
    libreadline-dev \
    libssl-dev \
    libtiff4-dev \
    libx11-dev \
    libxft-dev \
    libz-dev \
    xmlto \
    zlib1g-dev
</pre>

<p>
  Fedora and RedHat use <strong class="command">yum</strong> to manage packages
  from the command line instead of <strong class="command">apt-get</strong>. In
  testing, these were the packages required under RedHat:
</p>

<pre class="code">
<span class="command">sudo yum</span> install asciidoc \
    bzip2-devel \
    curl-devel \
    docbook2x \
    expat-devel \
    gettext-devel \
    gmp-devel \
    libX11-devel \
    libXft-devel \
    libjpeg-devel \
    libpng-devel \
    libtiff-devel \
    openssl-devel \
    perl-ExtUtils-Embed \
    readline-devel \
    xmlto \
    zlib-devel
</pre>

<p>
  If you are using a different distribution or package manager, or if your
  version of the OS does not seem to recognize those package names, then you'll
  need to search for packages with similar names as the above. The package
  names will normally end with -dev or -devel, which signifies that it will
  include the development libraries needed for software to compile using it.
</p>

<p>
  If your system does not appear to have a package manager, or if your system's
  OS is really old and uses outdated versions of the required libraries, or if
  you do not have system rights to install them, you may have to install them
  from source files that you download elsewhere. However, that is very advanced
  and is beyond the scope of this document.
</p>

<h2 id="need_sudo">Installing with sudo</h2>

<p>
  By default, ALPS installs to <strong class="directory">/opt/alps</strong>. On
  most systems, <strong class="directory">/opt</strong> is owned by root and
  cannot be modified by a normal user.
</p>

<p>
  In most software, this issue is addressed by running <strong
  class="command">make install</strong> using <strong
  class="command">sudo</strong>. This is normally preceded by two other steps,
  <strong class="command">./configure</strong> and <strong
  class="command">make</strong>.
</p>

<p>
</p>

<p>
  When installing ALPS, you should <em>not</em> use <strong
  class="command">sudo</strong> as mentioned above. You also shouldn't try to
  run <strong class="command">./configure</strong> (it doesn't exist) or
  <strong class="command">make</strong>. This is because the ALPS installer is
  comprised of numerous sub-installers, some of which depend on one another,
  which means that the installation process cannot be easily broken up into the
  traditional three parts.
</p>

<p>
  Instead, it is recommended that you use <strong class="command">sudo</strong>
  before and after installing ALPS to negate the issue of permissions, as so (assuming that your user name and group name are <strong class="replaceable">user</strong> and <strong class="replaceable">group</strong>):
</p>

<pre class="code">
<span class="command">sudo mkdir</span> -p <span class="directory">/opt/alps</span>
<span class="command">sudo chown -R <span class="replaceable">user</span>.<span class="replaceable">group</span> <span class="directory">/opt/alps</span>
<span class="command">cd</span> <span class="directory">alpsinstall.<span class="replaceable">20100328</span>/</span>
<span class="command">make</span> install
<span class="command">sudo chown</span> -R root.root <span class="directory">/opt/alps</span>
</pre>

<h2 id="disable_rlwrap">Problems with rlwrap</h2>

<p>
  The <strong class="command">rlwrap</strong> program requires the readline
  library. If your system does not have readline installed or if the installed
  version is too old, <strong class="command">rlwrap</strong> will not install
  and you will encounter errors. Ideally, you should attempt to install
  readline using the directions in <a href="#need_pkgs">Missing packages</a>.
</p>

<p>
  However, if for any reason you cannot install the readline library using your
  distribution's package management, you can omit rlwrap since it's an optional
  component. To disable rlwrap, you can unset the <strong
  class="variable">rlwrapsrc</strong> setting to prevent the installer from
  using it. For example:
</p>

<pre class="code">
<span class="command">make</span> install <span class="variable">rlwrapsrc</span>=
</pre>

<p>
  The above will set <strong class="variable">rlwrapsrc</strong> to a null
  value, effectively disabling it.
</p>

<h2 id="cctools_readline">Readline problems with cctools</h2>

<p>
  On certain versions of RedHat Enterprise Linux, the cctools installation does
  not work because it cannot find the readline development library, even though
  it's installed. If this is the case, the ALPS installation will fail and you
  will see errors similar to the following:
</p>

<pre class="code">
COMPILE make_int_sizes.o
LINK make_int_sizes
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tgetnum'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tgoto'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tgetflag'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `BC'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tputs'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `PC'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tgetent'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `UP'
/usr/lib/gcc/x86_64-redhat-linux/3.4.6/../../../../lib64/libreadline.so: undefined reference to `tgetstr'
collect2: ld returned 1 exit status
make[2]: *** [make_int_sizes] Error 1
make[2]: Leaving directory `/home/dnagle/alpsinstall.20111213/cctools-3.4.1-src/dttools/src'
/bin/sh: line 0: cd: test: No such file or directory
make[1]: *** [all] Error 1
make[1]: Leaving directory `/home/dnagle/alpsinstall.20111213/cctools-3.4.1-src/dttools'
/bin/sh: line 0: cd: sand: No such file or directory
/bin/sh: line 0: cd: allpairs: No such file or directory
/bin/sh: line 0: cd: wavefront: No such file or directory
/bin/sh: line 0: cd: makeflow: No such file or directory
/bin/sh: line 0: cd: ftp_lite: No such file or directory
/bin/sh: line 0: cd: s3tools: No such file or directory
/bin/sh: line 0: cd: chirp: No such file or directory
/bin/sh: line 0: cd: parrot: No such file or directory
/bin/sh: line 0: cd: doc: No such file or directory
/bin/sh: line 0: cd: apps: No such file or directory
/bin/sh: line 0: cd: work_queue: No such file or directory
make: *** [all] Error 1
</pre>

<p>
  If this happens, you have two options. The first is to try to help cctools
  find readline. The second is to omit cctools, which is an optional component
  of ALPS.
</p>

<h3 id="cctools_readline_help">Help cctools find readline</h3>

<p>
  To help cctools find readline, you'll need to manually run the cctools
  configuration script with some custom arguments. Follows is a modified
  installation procedure that illustrates.
</p>

<pre class="code">
<span class="command">cd</span> <span class="directory">alpsinstall.<span class="replaceable">20111213</span>/ctools-<span class="replaceable">3.4.1-src</span></span>
<span class="command">./configure</span> --with-readline-path /lib:/usr/lib --prefix <span class="directory"><span class="replaceable">/opt/alps</span>/cctools</span>
<span class="command">cd</span> ..
<span class="command">make</span> install prefix=<span class="directory"><span class="replaceable">/opt/alps</span></span>
</pre>

<p>
  If you're installing to the default location, you can omit the prefix= option
  from <strong class="command">make</strong>. However, you must always include
  the --prefix option to <strong class="command">configure</strong>.
</p>

<p>
  If the installation continues to fail after this change, then you'll either
  need to manually troubleshoot further or just omit cctools.
</p>

<h3 id="cctools_readline_omit">Omit cctools</h3>

<p>
  To omit cctools, just modify your <strong class="command">make</strong> call
  to include an empty cctoolssrc= option as follows.
</p>

<pre class="code">
<span class="command">make</span> install cctoolssrc=
</pre>

<p>
  If you are using other options such as prefix=, you will need to include it
  along with them.
</p>

<h2 id="fixed_width">GUIs have fixed-width font</h2>

<p>
  When you start ALPS, the GUIs should use a "normal" looking font. If they
  start up using a fixed-width font (like Courier), that indicates that one of
  the necessary development packages wasn't present during installation.
</p>

<p>
  To fix this problem, you'll need to install the XFT library development
  package (named something like libXft-devel or libxft-dev); see <a
  href="#need_pkgs">Missing packages</a> for details.
</p>

<p>
  Next, you'll need to repeat the installation process. Make sure you review <a
  href="#distclean">Modified configuration</a> first.
</p>

<p>
  Since the only part of the installation affected by this issue is Tcl/Tk, you
  can speed up the re-installation process by only re-installing Tcl/Tk.
  Directions for how to do so are provided under <a
  href="#upgrade_selective">Selective upgrade</a>.
</p>

<h2 id="distclean">Modified configuration</h2>

<p>
  If you try to repeat an installation after making changes to your system (for
  example, after installing <a href="#need_pkgs">missing development
  packages</a>), then you may find that the installation continues to fail even
  if it shouldn't be. This happens because the first installation attempt left
  configuration files that the second install attempted to use; since those
  configuration files reflected your system prior to the changes, the second
  attempt still fails. The solution is to clean out those configuration files.
</p>

<p>
  The first way to clean configuration files is to run the built-in cleaning
  method:
</p>

<pre class="code">
<span class="command">make</span> distclean
</pre>

<p>
  The distclean method removes most of the configuration files, but sometimes
  doesn't work perfectly. After using it, try to install again. If it fails
  again, then you can use the second way to clean: remove the install directory
  and extract a new copy. For example:
</p>

<pre class="code">
<span class="command">rm</span> -rf <span class="directory">alpsinstall.<span class="replaceable">20100328</span></span>
<span class="command">tar xjf</span> <span class="file">alpsinstall.<span class="replaceable">20100328</span>.tar.bz2</span>
</pre>

<p>
  If the install continues to fail, then unfortunately that means the problem
  lies elsewhere.
</p>

<h1 id="upgrade_package">Upgrading ALPS</h1>

<h2 id="upgrade_package_overview">Upgrade overview</h2>

<p>
  Upgrading is accomplished in exactly the same way as installing: download the
  installation package, unpack it, and run the appropriate <strong
  class="command">make</strong> command. The existing installation will be
  upgraded in-place.
</p>

<p>
  However, upgrading does differ from installing in a few key ways:
</p>

<ul>
<li>
  The installer will detect if the <strong
  class="directory">lidar-processing</strong> directory exists and is
  configured for Mercurial access. If it is, then new revisions (if any) will
  be pulled from the repository clone in the installer and the directory will
  be updated. If you have created a local branch, the update will fail; you
  should resolve any branching issues prior to installing.
</li>
<li>
  Your <strong class="directory">share</strong> directory will get updated with
  fresh copies of all provided files. Files you have added will not be removed.
  However, files with the same name may get overwritten.
</li>
<li>
  If you had to perform a local installation of the readline library to
  accomodate <strong class="command">rlwrap</strong>, then the existing
  installation from last time can be re-used during upgrade. You shouldn't need
  to upgrade readline.
</li>
</ul>

<h2 id="upgrade_selective">Selective upgrade</h2>

<p>
  If you only want to upgrade one of the major components (<strong
  class="command">python</strong>, which includes Mercurial; <strong
  class="command">rlwrap</strong>; <strong class="command">yorick</strong>,
  which includes all yorick-related plugins; <strong
  class="command">tcl</strong>, which includes all Tcl-related extensions;
  <strong class="command">gdal</strong>, or <strong
  class="command">magick</strong>), it's pretty easy to do so. Just run one of
  the
  following commands:
</p>

<pre class="code">
<span class="command">make</span> easy-python
<span class="command">make</span> easy-yorick
<span class="command">make</span> easy-rlwrap
<span class="command">make</span> easy-tcl
<span class="command">make</span> easy-gdal
<span class="command">make</span> easy-magick
</pre>

<p>
  The normal installation/upgrade procedure includes all those lines plus
  additional items. If you installed to an alternate location, you must also
  specify your <strong class="variable">prefix</strong>. For example:
</p>

<pre class="code">
<span class="command">make</span> easy-yorick <span class="variable">prefix</span>=<span class="replaceable">~/</span>alps
</pre>

<h2 id="nodata_download">The "-nodata" download</h2>

<p>
  The normal, full installation of ALPS is provided in a package named like
  <strong class="file">alpsinstall.<span
  class="replaceable">20100328</span>.tar.bz2</strong>. However, a second
  installation package is also available named like <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-nodata.tar.bz2</strong>. The "-nodata"
  version contains everything that the normal version does except for the data
  files under the <strong class="directory">share</strong> directory. This
  reduces the size of the package from over 200MB to under 20MB.
</p>

<p>
  If you are upgrading a fairly recently installation of ALPS and know that you
  already have all of the data files, then you can probably download and use
  the "-nodata" version instead of the full version. However, you should plan
  to occasionally upgrade using the full version to ensure that you get any new
  data files that might get added.
</p>

<p>
  When using the "-nodata" version, you still follow all other directions
  exactly the same as you normally would.
</p>

<h2 id="bye_activetcl">What happened to ActiveTcl?</h2>

<p>
  Prior to September 2011, ALPS used the binary distribution <a
  href="http://www.activestate.com/activetcl">ActiveTcl</a> from <a
  href="http://www.activestate.com">ActiveState</a> for its Tcl/Tk interpreter.
  Unfortunately, the license for ActiveTcl forbids its redistribution, which
  meant that older installers included a slimmed down custom Tcl interpreter
  and recommended the user download ActiveTcl for themselves.
</p>

<p>
  In September 2011, the installation procedure was simplified and made more
  robust by including the Tcl/Tk source code as well as the source code for all
  of the packages needed by ALPS. This eliminated the need for end-users to
  download ActiveTcl themselves and allows the full ALPS environment to be
  included in the ALPS installer.
</p>

<p>
  The source-based installation of Tcl/Tk added some additional development
  package prequisites for installation. If you encounter errors during
  installation, try reviewing <a href="#need_pkgs">Missing packages</a>.
</p>

<h2 id="migrating_201004">Upgrading installations from prior to April 2010</h2>

<p>
  The installation framework documented here was first put in place in March
  2010. If you have an ALPS that was installed prior to then, then your
  existing installation may be incompatible with the upgrade directions
  detailed under <a href="#upgrade_package">Upgrading ALPS</a>.
  Fortunately, it generally isn't too difficult to make the transition.
</p>

<p>
  Before migrating, there's a few things you may want to verify:
</p>

<ul>
<li>
  Did you do any code development for ALPS? If so, then read <a
  href="#migrating_201007">Installed prior to July 2010</a> in addition to
  this section. Then, if relevant, make a copy of your uncommited changes.
</li>
<li>
  Did you add any custom files to <strong class="directory"><span
  class="replaceable">/opt/</span>alps/lidar-processing/maps</strong>? The ALPS
  installer provides all of the maps that are available from from lidar.net
  (you can find them inside the installer at <strong class="directory"><span
  class="replaceable">alpsinstall.20100328/</span>share/maps</strong> if you
  want to compare). If you added any custom maps not included with ALPS that
  you'd like to keep, then you'll have to make a copy of them. After installing
  ALPS, you can then place those copies back in <strong class="directory"><span
  class="replaceable">/opt/</span>alps/share/maps</strong>.
</li>
</ul>

<p>
  Once you've made copies of any customized items you don't want to lose, you
  can then delete your existing ALPS installation and install a new one. You'll
  want to run a command like this one before installing ALPS to delete the old
  files:
</p>

<pre class="code">
<span class="command">rm</span> -rf <span class="directory"><span class="replaceable">/opt/</span>alps</span>
</pre>

<p>
  Depending on how you installed your old copy of ALPS, you may also have
  related software installed at alternate locations such as <strong
  class="directory">/usr/local</strong>. If you decide to leave such software
  in place, it will not conflict with your new ALPS installation.
</p>

<h2 id="migrating_201007">Upgrading installations from prior to July 2010</h2>

<p>
  In July 2010, the ALPS repository was migrated from <a
  href="http://www.nongnu.org/cvs/">CVS</a> to <a
  href="http://mercurial.selenic.com/">Mercurial</a>. Thus, installations prior
  to July 2010 must have their existing <strong
  class="directory">lidar-processing</strong> directory removed so that it can
  be replaced with a Mercurial clone.
</p>

<p>
  If you do nothing, then the installer will take care of this for you. If your
  <strong class="directory">lidar-processing</strong> directory is a CVS
  checkout, then it will be renamed to <strong
  class="directory">lidar-processing-oldcvs</strong>. If it is not a CVS
  checkout, then it will be deleted; if you have changes you do not want lost,
  be sure to copy them before installing.
</p>

<p>
  If you have not done any development on ALPS, then you can safely delete the
  <strong class="directory">lidar-processing-oldcvs</strong> directory:
</p>

<pre class="code">
<span class="command">rm</span> -rf <span class="directory"><span class="replaceable">/opt/</span>alps/lidar-processing-oldcvs</span>
</pre>

<p>
  If you <em>have</em> done development on ALPS and you had not yet commited
  your changes to the repository, then you will have to migrate your changes to
  Mercurial before you can commit them. If your changes are non-trivial, you
  may wish to investigate using <strong class="command">cvs diff</strong> and
  <strong class="command">hg import</strong>; however, that is beyond the scope
  of this document.
</p>

<h2 id="migrating_201109">Upgrading installations from prior to September 2011</h2>

<p>
  In September 2011, the default/recommended system-wide location for ALPS was
  changed from <strong class="directory">/opt/eaarl</strong> to <strong
  class="directory">/opt/alps</strong>. If you wish to upgrade your existing
  ALPS installation, you can simply move the directory to the new default
  location:
</p>

<pre class="code">
<span class="command">mv</span> <span class="directory">/opt/eaarl</span> <span class="directory">/opt/alps</span>
</pre>

<p>
  Alternately, if you have not modified anything in your ALPS installation and
  you have downloaded the full installer, you can simply delete your old
  installation prior to installing the new version:
</p>

<pre class="code">
<span class="command">rm</span> -rf <span class="directory">/opt/eaarl</span>
</pre>

<p>
  It's also possible to upgrade ALPS while keeping it at the old location. This
  is not recommended, but if you need to do it, simply set the prefix to the
  old path:
</p>

<pre class="code">
<span class="command">make</span> install <span class="variable">prefix</span>=<span class="directory">/opt/eaarl</span>
</pre>

<h2 id="migrating_201504">Upgrading installations from prior to April 2015</h2>

<p>
  Prior to April 2015, the <strong class="directory">lidar-processing</strong>
  dirctory was managed as a collection of subrepositories. Starting in April
  2015, these were merged back to a single repository (which had been the case
  up to 2012).
</p>

<p>
  The new repository is incompatible with the old repository. If you do
  nothing, then the installation rename the existing directory to <strong
  class="directory">lidar-processing-29150923aa65</strong> (the suffix is the
  Mercurial identifier for the old repository).
</p>

<p>
  If you have not done any development on ALPS, then you can safely delete the
  <strong class="directory">lidar-processing-29150923aa65</strong> directory:
</p>

<pre class="code">
<span class="command">rm</span> -rf <span class="directory"><span class="replaceable">/opt/</span>alps/lidar-processing-29150923aa65</span>
</pre>

<h1 id="prep_package">Preparing an installation package</h1>

<h2 id="prep_scratch">From scratch</h2>
<p>
  These are the basic steps involved in creating an installation package
  largely from scratch.
</p>

<ol>
<li>
  Start with a pristine copy of the repository.
</li>
<li>
  Create a copy of <strong class="directory">installer</strong> that you can
  then build up into an actual installer.
<pre class="code">
<span class="command">cp</span> -r <span class="directory"><span class="replaceable">~/</span>alps/lidar-processing/installer/pkg</span> <span class="directory"><span class="replaceable">~/</span>alpsinstall.<span class="replaceable">20100328</span></span>
</pre>
</li>
<li>
  Create a headless clone of the repository at <strong class="directory"><span
  class="replaceable">~/</span>alpsinstall.<span
  class="replaceable">20100328</span>/lidar-processing</strong>.
<pre class="code">
<span class="command">cd</span> <span class="directory"><span class="replaceable">~/</span>alpsinstall.<span class="replaceable">20100328</span></span>
<span class="command">hg</span> clone -U <span class="directory"><span class="replaceable">/opt/</span>alps/lidar-processing</span>
</pre>
</li>
<li>
  Edit the file <strong class="file"><span
  class="replaceable">~/</span>alpsinstall.<span
  class="replaceable">20100328</span>/lidar-processing/.hg/hgrc</strong> to
  change the default path to <strong
  class="directory">ssh://lidar.net//repos/lidar-processing</strong>.
</li>
<li>
  Download all requisite installation archives and expand them into the
  installation directory. Check out all requisite installation repositories
  into the installation directory as well. The Makefile documents what needs to
  be downloaded and where to download them from.  Make sure everything
  autodetects properly.
</li>
<li>
  Obtain a pre-existing copy of the data archive (<strong
  class="file">alpsinstall.<span
  class="replaceable">20100109</span>-data.tar.bz</strong>), typically from
  lidar.net.
</li>
<li>
  Package everything together:
<pre class="code">
<span class="command">cd <strong class="file"><span class="replaceable">~/</span></strong>
<span class="command">/opt/alps/installer/package_installer.sh</span> <strong class="directory">alpsinstall.<span class="replaceable">20100328</span></strong> <strong class="directory"><span class="replaceable">/mnt/alps/install/</span>alpsinstall.<span class="replaceable">20100109</span>-data.tar.bz</strong>
</pre>
  This will create four archive files: <strong class="file">alpsinstall.<span
  class="replaceable">20100328</span>.tar.bz2</strong>, <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-nodata.tar.bz2</strong>, <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-data.tar.bz2</strong>, and <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-master.tar.bz2</strong>.
</li>
<li>
  Upload the four installation packages to lidar.net. If appropriate, delete
  the non-master packages from the previous installation package. (But never
  delete the master package.)
</li>
</ol>

<h2 id="prep_exist">From an existing installer</h2>
<p>
  However, it's much easier to create an updated installer by using an existing
  installer.
</p>
<ol>
<li>
  Obtain a master version of a prior copy of the installer.
</li>
<li>
  Expand the installer archive.
<pre class="code">
<span class="command">tar</span> xjf <span class="file">alpsinstall.<span class="replaceable">20100328</span>-master.tar.bz2</span>
</pre>
</li>
<li>
  Rename the resulting directory to reflect the current date.
<pre class="code">
<span class="command">mv</span> <span class="directory">alpsinstall.<span class="replaceable">20100328</span></span> <span class="directory">alpsinstall.<span class="replaceable">20110912</span></span>
</pre>
</li>
<li>
  Update the repository.
<pre class="code">
<span class="command">cd</span> <span class="directory"><span class="replaceable">~/</span>alpsinstall.<span class="replaceable">20110912</span>/lidar-processing</span>
<span class="command">hg</span> pull
</pre>
</li>
<li>
  Update repository-based installation subdirectories (typically checked out
  via CVS from SourceForge or via Git from GitHub) as desired, renaming the
  directory to change the date suffix to reflect the current date.
</li>
<li>
  Update other installation subdirectories by deleting the old versions,
  downloading the new tar files, and expanding into the installation directory.
</li>
<li>
  Update the Makefiles and share directory by copying from the repository.
<pre class="code">
<span class="command">cd</span> <span class="directory"><span class="replaceable">~/</span>alpsinstall.<span class="replaceable">20110912</span></span>
<span class="command">cp</span> -rf <span class="file"><span class="replaceable">/opt/</span>alps/lidar-processing/installer/pkg/*<span> <span class="directory">./</span>
</pre>
</li>
<li>
  Package everything together:
<pre class="code">
<span class="command">cd <strong class="file"><span class="replaceable">~/</span></strong>
<span class="command">/opt/alps/installer/package_installer.sh</span> <strong class="directory">alpsinstall.<span class="replaceable">20100328</span></strong> <strong class="directory"><span class="replaceable">/mnt/alps/install/</span>alpsinstall.<span class="replaceable">20100109</span>-data.tar.bz</strong>
</pre>
  This will create four archive files: <strong class="file">alpsinstall.<span
  class="replaceable">20100328</span>.tar.bz2</strong>, <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-nodata.tar.bz2</strong>, <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-data.tar.bz2</strong>, and <strong
  class="file">alpsinstall.<span
  class="replaceable">20100328</span>-master.tar.bz2</strong>.
</li>
<li>
  Upload the four installation packages to lidar.net. If appropriate, delete
  the non-master packages from the previous installation package. (But never
  delete the master package.)
</li>
</ol>

</div>
</body>
</html>
