#!/opt/alps/bin/yorick -batch

// _ytk = 1;
src_path = "/opt/alps/lidar-processing/src";

cd(src_path);

#include "/opt/alps/lidar-processing/src/eaarl.i"

// Need to peek inside of the cmd file to see what plugins to load
f = openb(cmdline(2));
if(has_member(f, "plugins")) {
  plugins_load, f.plugins;
} else {
  plugins_load, "eaarlb";
}
close, f;

cmdline = get_argv();  /* strips -batch cmdline.i */
if (numberof(cmdline) == 3) {
  /* convert from ascii to pdb binary format */
  cmdline(1);
  cmdline(2);
  cmdline(3);
  write, format="cmd1:%s\ncmd2:%s:%s\n", cmdline(1), cmdline(2), cmdline(3);
  unpackage_tile,fn=cmdline(2), host=cmdline(3);
  call_process_tile,host=cmdline(3);
} else {
  write, "Usage: yorick -batch cmdline.i infile hostname";
}

quit;

